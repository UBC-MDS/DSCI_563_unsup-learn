

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Lecture 8: Recommender Systems Part 2 &#8212; DSCI 563 Unsupervised Learning</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'lectures/08_recommender-systems2';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Appendix A: K-Means customer segmentation case study" href="AppendixA.html" />
    <link rel="prev" title="Lecture 7: Recommender Systems Part I" href="07_recommender-systems1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/mds-hex-sticker.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/mds-hex-sticker.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00_course-information.html">Course Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_K-Means.html">Lecture 1: K-Means Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_DBSCAN-hierarchical.html">Lecture 2: DBSCAN and Hierarchical Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_PCA-intro.html">Lecture 3: Introduction to Principal Component Analysis (PCA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_More-PCA-LSA-NMF.html">Lecture 4: More PCA, LSA, and NMF</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_word-embeddings.html">Lecture 5: Word Embeddings, word2vec</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_more-word2vec-tsne.html">Lecture 6: Using word embeddings, manifold learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_recommender-systems1.html">Lecture 7: Recommender Systems Part I</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 8: Recommender Systems Part 2</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="AppendixA.html">Appendix A: K-Means customer segmentation case study</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Attribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../attribution.html">Attributions</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/UBC-MDS/DSCI_563_unsup-learn" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/lectures/08_recommender-systems2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 8: Recommender Systems Part 2</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-plan-imports-and-los">Lecture plan, imports, and LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-plan">Lecture plan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">1. Recap</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-recommender-systems-problem">1.1 Recap: Recommender systems problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-main-approaches">1.2 Recap: Main approaches</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-collaborative-filtering">1.3 Recap: Collaborative filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-similarity-distances">1.4 Measuring similarity/distances</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content-based-filtering">2. Content-based filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#movie-features">2.1 Movie features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-user-profiles">2.2 Building user profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supervised-approach-to-rating-prediction">2.3 Supervised approach to rating prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#completing-the-utility-matrix-with-content-based-filtering">2.4 Completing the utility matrix with content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellaneous-comments-on-content-based-filtering">2.5 Miscellaneous comments on content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-hybrid-approaches">2.6 (Optional) Hybrid approaches</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-8-1-select-all-of-the-following-statements-which-are-true-iclicker">Exercise 8.1 Select all of the following statements which are <strong>True</strong> (iClicker)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellaneous-topics">3. Miscellaneous topics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-data">3.1 Types of data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sparse-utility-matrix">3.2 Sparse utility matrix</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beyond-error-rate-in-recommendation-systems">4. Beyond error rate in recommendation systems</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-comments-and-summary">Final comments and summary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-cover">What did we cover?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reminder">Reminder</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you-time-permitting">❓❓ Questions for you (time-permitting)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#course-roadmap">Course roadmap</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-for-course-evaluations">Time for course evaluations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources">Resources</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p><img alt="" src="../_images/563_banner.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="lecture-8-recommender-systems-part-2">
<h1>Lecture 8: Recommender Systems Part 2<a class="headerlink" href="#lecture-8-recommender-systems-part-2" title="Permalink to this heading">#</a></h1>
<p>UBC Master of Data Science program, 2023-24</p>
<p>Instructor: Varada Kolhatkar</p>
<section id="lecture-plan-imports-and-los">
<h2>Lecture plan, imports, and LOs<a class="headerlink" href="#lecture-plan-imports-and-los" title="Permalink to this heading">#</a></h2>
<section id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span> <span class="s2">&quot;code&quot;</span><span class="p">))</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span><span class="p">,</span> <span class="n">train_test_split</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.max_colwidth&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</section>
<section id="lecture-plan">
<h3>Lecture plan<a class="headerlink" href="#lecture-plan" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Recap (~15 mins)</p></li>
<li><p>Content-based filtering (25 mins)</p></li>
<li><p>Break (~5 mins)</p></li>
<li><p>Questions for class discussion ( ~5 mins)</p></li>
<li><p>Miscellaneous topics (~10 mins)</p></li>
<li><p>Final comments, summary, reflection (~5 mins)</p></li>
<li><p>Course evaluations (time-permitting) (~5 mins)</p></li>
</ul>
<p><br><br></p>
</section>
<section id="learning-outcomes">
<h3>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Permalink to this heading">#</a></h3>
<p>From this lecture, students are expected to be able to:</p>
<ul class="simple">
<li><p>Formulate the rating prediction problem as a supervised machine learning problem.</p></li>
<li><p>Create a content-based filter given ratings data and item features to predict missing ratings in the utility matrix.</p></li>
<li><p>Discuss differences, advantages and disadvantages between content-based filtering and collaborative filtering.</p></li>
<li><p>Explain the idea of hybrid approaches at a high level.</p></li>
<li><p>Create and work with a sparse utility matrix for datasets with large number of items and users.</p></li>
<li><p>Name different kinds of data which occur in the context of recommendation systems.</p></li>
<li><p>Discuss important considerations in recommendation systems beyond error rate.</p></li>
</ul>
</section>
</section>
<section id="recap">
<h2>1. Recap<a class="headerlink" href="#recap" title="Permalink to this heading">#</a></h2>
<hr><section id="recap-recommender-systems-problem">
<h3>1.1 Recap: Recommender systems problem<a class="headerlink" href="#recap-recommender-systems-problem" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We are usually given ratings data.</p></li>
<li><p>We use this data to create <strong>utility matrix</strong> which encodes interactions between users and items.</p></li>
<li><p>The utility matrix has many missing entries.</p></li>
<li><p>We defined recommendation systems problem as <strong>matrix completion problem</strong>.</p></li>
</ul>
<p><img alt="" src="../_images/utility_matrix.png" /></p>
<p>Let’s load some toy data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">toy_ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/toy_ratings.csv&quot;</span><span class="p">)</span>
<span class="n">toy_ratings</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>movie_id</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sam</td>
      <td>Lion King</td>
      <td>4</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Sam</td>
      <td>Jerry Maguire</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Sam</td>
      <td>Roman Holidays</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Sam</td>
      <td>Downfall</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Eva</td>
      <td>Titanic</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Eva</td>
      <td>Jerry Maguire</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Eva</td>
      <td>Inception</td>
      <td>4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Eva</td>
      <td>Man on Wire</td>
      <td>5</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Eva</td>
      <td>The Social Dilemma</td>
      <td>5</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Pat</td>
      <td>Titanic</td>
      <td>3</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Pat</td>
      <td>Lion King</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Pat</td>
      <td>Bambi</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Pat</td>
      <td>Cast Away</td>
      <td>3</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Pat</td>
      <td>Jerry Maguire</td>
      <td>5</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Pat</td>
      <td>Downfall</td>
      <td>2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Pat</td>
      <td>A Beautiful Mind</td>
      <td>3</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Jim</td>
      <td>Titanic</td>
      <td>2</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Jim</td>
      <td>Lion King</td>
      <td>3</td>
    </tr>
    <tr>
      <th>18</th>
      <td>Jim</td>
      <td>The Social Dilemma</td>
      <td>5</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Jim</td>
      <td>Malcolm x</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Jim</td>
      <td>Man on Wire</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]))</span>
<span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="s2">&quot;movie_id&quot;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of users (N): </span><span class="si">{</span><span class="n">N</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of movies (M): </span><span class="si">{</span><span class="n">M</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of users (N): 4
Number of movies (M): 12
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_key</span> <span class="o">=</span> <span class="s2">&quot;user_id&quot;</span>
<span class="n">item_key</span> <span class="o">=</span> <span class="s2">&quot;movie_id&quot;</span>
<span class="n">user_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))))</span>
<span class="n">item_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">))))</span>
<span class="n">user_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">])))</span>
<span class="n">item_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">])))</span>

<span class="k">def</span> <span class="nf">create_Y_from_ratings</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
    <span class="n">Y</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">user_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">user_key</span><span class="p">]]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">item_key</span><span class="p">]]</span>
        <span class="n">Y</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">Y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">create_Y_from_ratings</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
<span class="n">utility_mat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">item_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">user_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">utility_mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A Beautiful Mind</th>
      <th>Bambi</th>
      <th>Cast Away</th>
      <th>Downfall</th>
      <th>Inception</th>
      <th>Jerry Maguire</th>
      <th>Lion King</th>
      <th>Malcolm x</th>
      <th>Man on Wire</th>
      <th>Roman Holidays</th>
      <th>The Social Dilemma</th>
      <th>Titanic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Eva</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Jim</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Pat</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Sam</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</section>
<section id="recap-main-approaches">
<h3>1.2 Recap: Main approaches<a class="headerlink" href="#recap-main-approaches" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Collaborative filtering (last lecture)</p>
<ul>
<li><p>“Unsupervised” learning</p></li>
<li><p>We only have labels <span class="math notranslate nohighlight">\(y_{ij}\)</span> (rating of user <span class="math notranslate nohighlight">\(i\)</span> for item <span class="math notranslate nohighlight">\(j\)</span>).</p></li>
<li><p>We learn latent features.</p></li>
</ul>
</li>
<li><p><strong>Content-based recommenders (today’s focus)</strong></p>
<ul>
<li><p>Supervised learning</p></li>
<li><p>Extract features <span class="math notranslate nohighlight">\(x_i\)</span> of users and/or items building a model to predict rating <span class="math notranslate nohighlight">\(y_i\)</span> given <span class="math notranslate nohighlight">\(x_i\)</span>.</p></li>
<li><p>Apply model to predict for new users/items.</p></li>
</ul>
</li>
<li><p>Hybrid</p>
<ul>
<li><p>Combining collaborative filtering with content-based filtering</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</section>
<section id="recap-collaborative-filtering">
<h3>1.3 Recap: Collaborative filtering<a class="headerlink" href="#recap-collaborative-filtering" title="Permalink to this heading">#</a></h3>
<p>In the last lecture we talked about collaborative filtering</p>
<ul class="simple">
<li><p><strong>People who agreed in the past are likely to agree again in future.</strong></p></li>
<li><p>“Unsupervised” learning</p>
<ul>
<li><p>We only have labels <span class="math notranslate nohighlight">\(Y\)</span> (ratings <span class="math notranslate nohighlight">\(y_{ij}\)</span> for user <span class="math notranslate nohighlight">\(i\)</span> and item <span class="math notranslate nohighlight">\(j\)</span>) but no features of items or users.</p></li>
</ul>
</li>
<li><p>We use PCA-like approach to learn the latent features of users and items.</p></li>
<li><p>You can think of <span class="math notranslate nohighlight">\(Z\)</span> matrix as user embeddings and <span class="math notranslate nohighlight">\(W\)</span> matrix as item embeddings.</p></li>
<li><p>Then the predicted rating is multiplication of a corresponding user and item embeddings.</p></li>
<li><p>The key idea is that the loss function only includes the available ratings and regularization terms for <span class="math notranslate nohighlight">\(W\)</span> and <span class="math notranslate nohighlight">\(Z\)</span> to avoid overfitting.</p></li>
<li><p>So instead of using the regular PCA or <code class="docutils literal notranslate"><span class="pre">TruncatedSVD</span></code>, we implement our own loss function or use a package which implements this loss function (e.g., surprise package).
<img alt="" src="../_images/toy-movie-pred.png" /></p></li>
</ul>
</section>
<section id="measuring-similarity-distances">
<h3>1.4 Measuring similarity/distances<a class="headerlink" href="#measuring-similarity-distances" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>After training a collaborative filtering model, we have user embeddings and item embeddings.</p></li>
<li><p>We use these embeddings to make recommendations.</p></li>
<li><p>In particular, these embeddings are used to match users with items or to find users with similar preferences and items with similar characteristics.</p></li>
<li><p>So the notion of <strong>similarity</strong> or <strong>distances</strong> plays a crucial role in this context</p></li>
</ul>
<ul class="simple">
<li><p>There are two primary similarity measures used in this context:</p>
<ul>
<li><p><strong>Dot products</strong> measure the similarity through the alignment of vectors in a high-dimensional space. Higher dot product means a greater degree of similarity, assuming that the vectors are non-negative.<br />
$<span class="math notranslate nohighlight">\(similarity_{dot\_product}(u, v) = u.v\)</span>$</p></li>
<li><p><strong>Cosine similarity</strong> measures the cosine of the angle between two vectors
$<span class="math notranslate nohighlight">\(similarity_{cosine}(u,v) = cosine(u,v) = \frac{u.v}{\left\lVert u\right\rVert_2 \left\lVert v\right\rVert_2}\)</span>$</p></li>
</ul>
</li>
</ul>
<p><strong>Discussion question</strong></p>
<p>Suppose you are recommending items based on similarity between items. Given a query vector “Query” in the picture below and the three item vectors, determine the ranking of the items for the three similarity measures below:</p>
<ul class="simple">
<li><p><strong>Example: Similarity based on Euclidean distance: item 3 &gt; item 1 &gt; item 2</strong></p></li>
<li><p>Similarity based on dot product: <strong>item 2 &gt; item 3 &gt; item 1</strong></p></li>
<li><p>Cosine similarity: <strong>item 1 &gt; item 2 &gt; item 3</strong></p></li>
</ul>
<!-- <img src="img/distance-metrics.png" alt="" height="800" width="500">  -->
<p><img alt="" src="../_images/distance-metrics.png" /></p>
<ul class="simple">
<li><p>Adapted from <a class="reference external" href="https://developers.google.com/machine-learning/recommendation/overview/candidate-generation">here</a>.</p></li>
</ul>
<p><strong>Which similarity metric to use in what context?</strong></p>
<ul class="simple">
<li><p>The choice of similarity metric can have a significant impact on the behavior of the recommendation system.</p></li>
</ul>
<p><strong>dot product similarity</strong></p>
<ul class="simple">
<li><p>Larger norms can lead to higher similarity scores, which means that items with larger norms are more likely to be recommended.</p></li>
<li><p>If popularity is an important factor for recommendations in your system, this characteristic of the dot product can be beneficial because it naturally boosts recommendations of popular items.</p></li>
<li><p>That said, this can also lead to a lack of diversity in recommendations because popular items might overshadow less popular, yet still relevant, items.</p></li>
</ul>
<p><strong>Cosine Similarity:</strong></p>
<ul class="simple">
<li><p>Cosine similarity measures the cosine of the angle between two vectors, which corresponds to their directional alignment, independent of their magnitude.</p></li>
<li><p>This means that even if an item has a large norm, it won’t be recommended unless it’s directionally similar to the user’s preference vector.</p></li>
<li><p>Cosine similarity is often used when the scale of the embeddings should not influence the recommendation, providing a more balanced field for both popular and less popular items.</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="content-based-filtering">
<h2>2. Content-based filtering<a class="headerlink" href="#content-based-filtering" title="Permalink to this heading">#</a></h2>
<hr><ul class="simple">
<li><p>What if a new item or a new user shows up?</p>
<ul>
<li><p>You won’t have any ratings information for that item or user</p></li>
</ul>
</li>
<li><p>Content-based filtering is suitable to predict ratings for new items and new users.</p></li>
<li><p>Content-based filtering is a <strong>upervised machine learning</strong> approach to recommender systems.</p></li>
<li><p>In collaborative filtering we assumed that we only have ratings data.</p></li>
<li><p>Usually there is some information available about items and users.</p></li>
<li><p>Examples</p>
<ul>
<li><p>Netflix can describe movies as action, romance, comedy, documentaries.</p></li>
<li><p>Netflix has some demographic and preference information on users.</p></li>
<li><p>Amazon could describe books according to topics: math, languages, history.</p></li>
<li><p>Tinder could describe people according to age, location, employment.</p></li>
</ul>
</li>
<li><p>Can we use this information to predict ratings in the utility matrix?</p>
<ul>
<li><p>Yes! Using content-based filtering!</p></li>
</ul>
</li>
</ul>
<p><strong>Overview</strong></p>
<p>In content-based filtering,</p>
<ul class="simple">
<li><p>We assume that we are given item or user feature.</p></li>
<li><p>Given movie information, for instance, we <strong>create user profile for each user</strong>.</p></li>
<li><p>We treat ratings prediction problem as <strong>a set of regression problems</strong> and build regression model for each user.</p></li>
<li><p>Once we have trained regression models for each user, we <strong>complete the utility matrix by predicting ratings for each user</strong> using their corresponding models.</p></li>
</ul>
<p><img alt="" src="lectures/img/content-based-filtering.png" /></p>
<p>Let’s look into each of these steps one by one with a toy example.</p>
<section id="movie-features">
<h3>2.1 Movie features<a class="headerlink" href="#movie-features" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Suppose we also have movie features. In particular, suppose we have information about the genre of each movie.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movie_feats_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/toy_movie_feats.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">movie_feats_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>A Beautiful Mind</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Bambi</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Cast Away</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Downfall</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Inception</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Jerry Maguire</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Lion King</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Man on Wire</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>The Social Dilemma</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(12, 6)
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>How can we use these features to predict missing ratings?</p></li>
<li><p>Using the ratings data and movie features:</p>
<ul>
<li><p>Build <strong>profiles for different users</strong>.</p></li>
<li><p>Train a <strong>supervised machine learning model for each user</strong>.</p></li>
<li><p>Predict ratings using the trained models</p></li>
</ul>
</li>
</ul>
<ul class="simple">
<li><p>Let’s consider an example user <strong>Pat</strong>.</p></li>
<li><p>We don’t know anything about Pat but we know her ratings to movies.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">utility_mat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Pat&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A Beautiful Mind      3.0
Bambi                 4.0
Cast Away             3.0
Downfall              2.0
Inception            NaN 
Jerry Maguire         5.0
Lion King             4.0
Malcolm x            NaN 
Man on Wire          NaN 
Roman Holidays       NaN 
The Social Dilemma   NaN 
Titanic               3.0
Name: Pat, dtype: float64
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>We also know about movies and their features.</p></li>
<li><p>If Pat gave a high rating to <em>Lion King</em>, it means that she liked the features of the movie.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;Lion King&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Action         0
Romance        0
Drama          1
Comedy         0
Children       1
Documentary    0
Name: Lion King, dtype: int64
</pre></div>
</div>
</div>
</div>
<p><br><br></p>
</section>
<section id="building-user-profiles">
<h3>2.2 Building user profiles<a class="headerlink" href="#building-user-profiles" title="Permalink to this heading">#</a></h3>
<p>For each user <span class="math notranslate nohighlight">\(i\)</span> create a user profile as follows.</p>
<ul class="simple">
<li><p>Consider all movies rated by <span class="math notranslate nohighlight">\(i\)</span> and create <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for the user:</p>
<ul>
<li><p>Each row in <code class="docutils literal notranslate"><span class="pre">X</span></code> contains the movie features of movie <span class="math notranslate nohighlight">\(j\)</span> rated by <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
<li><p>Each value in <code class="docutils literal notranslate"><span class="pre">y</span></code> is the corresponding rating given to the movie <span class="math notranslate nohighlight">\(j\)</span> by user <span class="math notranslate nohighlight">\(i\)</span>.</p></li>
</ul>
</li>
<li><p>Fit a regression model using <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code>.</p></li>
<li><p>Apply the model to predict ratings for new items!</p></li>
</ul>
<p>As an example, let’s build a profile for pat.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Which movies are rated by Pat? </span>

<span class="n">movies_rated_by_pat</span> <span class="o">=</span> <span class="n">toy_ratings</span><span class="p">[</span><span class="n">toy_ratings</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Pat&#39;</span><span class="p">][[</span><span class="s1">&#39;movie_id&#39;</span><span class="p">,</span> <span class="s1">&#39;rating&#39;</span><span class="p">]]</span>
<span class="n">movies_rated_by_pat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>movie_id</th>
      <th>rating</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>9</th>
      <td>Titanic</td>
      <td>3</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Lion King</td>
      <td>4</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Bambi</td>
      <td>4</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Cast Away</td>
      <td>3</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Jerry Maguire</td>
      <td>5</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Downfall</td>
      <td>2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>A Beautiful Mind</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(12, 6)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get feature vectors of movies rated by Pat. </span>

<span class="n">pat_X</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">pat_y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">movies_rated_by_pat</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Get the id of this movie rated by Pat       </span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;movie_id&#39;</span><span class="p">]]</span>
    
    <span class="c1"># Get the feature vector for the movie </span>
    <span class="n">pat_X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
    
    <span class="c1"># Get the rating for the movie</span>
    <span class="n">pat_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;rating&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pat_X</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movies_rated_by_pat</span><span class="p">[</span><span class="s1">&#39;movie_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Lion King</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Bambi</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Cast Away</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Jerry Maguire</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Downfall</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>A Beautiful Mind</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pat_y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[3, 4, 4, 3, 5, 2, 3]
</pre></div>
</div>
</div>
</div>
<p>Similar to how we created <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for Pat above, the function below builds <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for all users.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">def</span> <span class="nf">get_lr_data_per_user</span><span class="p">(</span><span class="n">ratings_df</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">lr_y</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">lr_X</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">lr_items</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ratings_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">user_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">user_key</span><span class="p">]]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">val</span><span class="p">[</span><span class="n">item_key</span><span class="p">]]</span>
        <span class="n">lr_X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
        <span class="n">lr_y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">])</span>
        <span class="n">lr_items</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">lr_X</span><span class="p">:</span>
        <span class="n">lr_X</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lr_X</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
        <span class="n">lr_y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lr_y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">lr_X</span><span class="p">,</span> <span class="n">lr_y</span><span class="p">,</span> <span class="n">lr_items</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">X_train_usr</span><span class="p">,</span> <span class="n">y_train_usr</span><span class="p">,</span> <span class="n">rated_items</span> <span class="o">=</span> <span class="n">get_lr_data_per_user</span><span class="p">(</span><span class="n">toy_ratings</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_usr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>defaultdict(list,
            {3: array([[0, 0, 1, 0, 1, 0],
                    [0, 1, 1, 1, 0, 0],
                    [0, 1, 1, 1, 0, 0],
                    [0, 0, 0, 0, 0, 1]]),
             0: array([[0, 1, 1, 0, 0, 0],
                    [0, 1, 1, 1, 0, 0],
                    [1, 0, 1, 0, 0, 0],
                    [0, 0, 0, 0, 0, 1],
                    [0, 0, 0, 0, 0, 1]]),
             2: array([[0, 1, 1, 0, 0, 0],
                    [0, 0, 1, 0, 1, 0],
                    [0, 0, 1, 0, 1, 0],
                    [0, 1, 1, 0, 0, 0],
                    [0, 1, 1, 1, 0, 0],
                    [0, 0, 0, 0, 0, 1],
                    [0, 1, 1, 0, 0, 0]]),
             1: array([[0, 1, 1, 0, 0, 0],
                    [0, 0, 1, 0, 1, 0],
                    [0, 0, 0, 0, 0, 1],
                    [0, 0, 0, 0, 0, 1],
                    [0, 0, 0, 0, 0, 1]])})
</pre></div>
</div>
</div>
</div>
<p>Do you think the shape of <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for all users would be the same?</p>
<p><strong>Examining user profiles</strong></p>
<ul class="simple">
<li><p>Let’s examine some user profiles.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_user_profile</span><span class="p">(</span><span class="n">user_name</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">rated_items</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">movie_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">item_inverse_mapper</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Profile for user: &quot;</span><span class="p">,</span> <span class="n">user_name</span><span class="p">)</span>
    <span class="n">profile_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movie_names</span><span class="p">)</span>
    <span class="n">profile_df</span><span class="p">[</span><span class="s2">&quot;ratings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">profile_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_user_profile</span><span class="p">(</span><span class="s2">&quot;Pat&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Profile for user:  Pat
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Lion King</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>Bambi</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>Cast Away</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
    <tr>
      <th>Jerry Maguire</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>5</td>
    </tr>
    <tr>
      <th>Downfall</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>A Beautiful Mind</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Pat seems to like Children’s movies and movies with Comedy.</p></li>
<li><p>Seems like she’s not so much into romantic movies.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_user_profile</span><span class="p">(</span><span class="s2">&quot;Eva&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Profile for user:  Eva
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Titanic</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>Jerry Maguire</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>Inception</th>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>4</td>
    </tr>
    <tr>
      <th>Man on Wire</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <th>The Social Dilemma</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Eva hasn’t rated many movies. There are not many rows.</p></li>
<li><p>Eva seems to like documentaries and action movies.</p></li>
<li><p>Seems like she’s not so much into romantic movies.</p></li>
</ul>
<p><br><br></p>
</section>
<section id="supervised-approach-to-rating-prediction">
<h3>2.3 Supervised approach to rating prediction<a class="headerlink" href="#supervised-approach-to-rating-prediction" title="Permalink to this heading">#</a></h3>
<p>Given <code class="docutils literal notranslate"><span class="pre">X</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> for each user, we can now build a regression model for each user.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>


<span class="k">def</span> <span class="nf">train_for_usr</span><span class="p">(</span><span class="n">user_name</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Ridge</span><span class="p">()):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">X_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y_train_usr</span><span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">user_name</span><span class="p">]]</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>


<span class="k">def</span> <span class="nf">predict_for_usr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">movie_names</span><span class="p">):</span>
    <span class="n">feat_vecs</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movie_names</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">feat_vecs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">preds</span>
</pre></div>
</div>
</div>
</div>
<p><strong>A regression model for Pat</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Pat&quot;</span>
<span class="n">pat_model</span> <span class="o">=</span> <span class="n">train_for_usr</span><span class="p">(</span><span class="n">user_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Since we are training ridge model, we can examine the coefficients</p></li>
<li><p>What are the regression weights learned for Pat?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">col</span> <span class="o">=</span> <span class="s2">&quot;Coefficients for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">user_name</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pat_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients for Pat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Action</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Romance</th>
      <td>-0.020833</td>
    </tr>
    <tr>
      <th>Drama</th>
      <td>0.437500</td>
    </tr>
    <tr>
      <th>Comedy</th>
      <td>0.854167</td>
    </tr>
    <tr>
      <th>Children</th>
      <td>0.458333</td>
    </tr>
    <tr>
      <th>Documentary</th>
      <td>-0.437500</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>How would Pat rate some movies she hasn’t seen?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">movies_to_pred</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Roman Holidays&quot;</span><span class="p">,</span> <span class="s2">&quot;Malcolm x&quot;</span><span class="p">]</span>
<span class="n">pred_df</span> <span class="o">=</span> <span class="n">movie_feats_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">movies_to_pred</span><span class="p">]</span>
<span class="n">pred_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Pat&quot;</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">predict_for_usr</span><span class="p">(</span><span class="n">pat_model</span><span class="p">,</span> <span class="n">movies_to_pred</span><span class="p">)</span>
<span class="n">pred_df</span><span class="p">[</span><span class="n">user_name</span> <span class="o">+</span> <span class="s2">&quot;&#39;s predicted ratings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<span class="n">pred_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>Pat's predicted ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>4.145833</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2.437500</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><strong>A regression model for Eva</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Eva&quot;</span>
<span class="n">eva_model</span> <span class="o">=</span> <span class="n">train_for_usr</span><span class="p">(</span><span class="n">user_name</span><span class="p">)</span>
<span class="n">col</span> <span class="o">=</span> <span class="s2">&quot;Coefficients for </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">user_name</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">eva_model</span><span class="o">.</span><span class="n">coef_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">movie_feats_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Coefficients for Eva</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Action</th>
      <td>0.333333</td>
    </tr>
    <tr>
      <th>Romance</th>
      <td>-1.000000</td>
    </tr>
    <tr>
      <th>Drama</th>
      <td>-0.666667</td>
    </tr>
    <tr>
      <th>Comedy</th>
      <td>-0.666667</td>
    </tr>
    <tr>
      <th>Children</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>Documentary</th>
      <td>0.666667</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>What are the predicted ratings for Eva for a list of movies?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Eva&quot;</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">predict_for_usr</span><span class="p">(</span><span class="n">eva_model</span><span class="p">,</span> <span class="n">movies_to_pred</span><span class="p">)</span>
<span class="n">pred_df</span><span class="p">[</span><span class="n">user_name</span> <span class="o">+</span> <span class="s2">&quot;&#39;s predicted ratings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">preds</span>
<span class="n">pred_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Action</th>
      <th>Romance</th>
      <th>Drama</th>
      <th>Comedy</th>
      <th>Children</th>
      <th>Documentary</th>
      <th>Pat's predicted ratings</th>
      <th>Eva's predicted ratings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Roman Holidays</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>4.145833</td>
      <td>1.666667</td>
    </tr>
    <tr>
      <th>Malcolm x</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2.437500</td>
      <td>4.666667</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><br><br></p>
</section>
<section id="completing-the-utility-matrix-with-content-based-filtering">
<h3>2.4 Completing the utility matrix with content-based filtering<a class="headerlink" href="#completing-the-utility-matrix-with-content-based-filtering" title="Permalink to this heading">#</a></h3>
<p>Here is the original utility matrix.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">utility_mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A Beautiful Mind</th>
      <th>Bambi</th>
      <th>Cast Away</th>
      <th>Downfall</th>
      <th>Inception</th>
      <th>Jerry Maguire</th>
      <th>Lion King</th>
      <th>Malcolm x</th>
      <th>Man on Wire</th>
      <th>Roman Holidays</th>
      <th>The Social Dilemma</th>
      <th>Titanic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Eva</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Jim</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>Pat</th>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Sam</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Using predictions per user, we can fill in missing entries in the utility matrix.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>

<span class="n">models</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="n">pred_lin_reg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">models</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">()</span>
    <span class="n">models</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_usr</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">y_train_usr</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="n">pred_lin_reg</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pred_lin_reg</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">item_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">user_mapper</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A Beautiful Mind</th>
      <th>Bambi</th>
      <th>Cast Away</th>
      <th>Downfall</th>
      <th>Inception</th>
      <th>Jerry Maguire</th>
      <th>Lion King</th>
      <th>Malcolm x</th>
      <th>Man on Wire</th>
      <th>Roman Holidays</th>
      <th>The Social Dilemma</th>
      <th>Titanic</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Eva</th>
      <td>2.333333</td>
      <td>3.333333</td>
      <td>2.333333</td>
      <td>4.666667</td>
      <td>3.666667</td>
      <td>1.666667</td>
      <td>3.333333</td>
      <td>4.666667</td>
      <td>4.666667</td>
      <td>1.666667</td>
      <td>4.666667</td>
      <td>2.333333</td>
    </tr>
    <tr>
      <th>Jim</th>
      <td>2.575000</td>
      <td>3.075000</td>
      <td>2.575000</td>
      <td>4.450000</td>
      <td>3.150000</td>
      <td>2.575000</td>
      <td>3.075000</td>
      <td>4.450000</td>
      <td>4.450000</td>
      <td>2.575000</td>
      <td>4.450000</td>
      <td>2.575000</td>
    </tr>
    <tr>
      <th>Pat</th>
      <td>3.291667</td>
      <td>3.770833</td>
      <td>3.291667</td>
      <td>2.437500</td>
      <td>3.312500</td>
      <td>4.145833</td>
      <td>3.770833</td>
      <td>2.437500</td>
      <td>2.437500</td>
      <td>4.145833</td>
      <td>2.437500</td>
      <td>3.291667</td>
    </tr>
    <tr>
      <th>Sam</th>
      <td>3.810811</td>
      <td>3.675676</td>
      <td>3.810811</td>
      <td>1.783784</td>
      <td>3.351351</td>
      <td>4.270270</td>
      <td>3.675676</td>
      <td>1.783784</td>
      <td>1.783784</td>
      <td>4.270270</td>
      <td>1.783784</td>
      <td>3.810811</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>In this toy example, we assumed access to item features. Frequently, we also have access to user features, including demographic information.</p></li>
<li><p>With this data, we can construct item profiles similar to user profiles and train a unique regression model for each item.</p></li>
<li><p>These models enable us to predict ratings for each item individually.</p></li>
<li><p>Typically, the final rating is derived from a weighted average that combines the ratings suggested by both item features and user features.</p></li>
</ul>
<ul class="simple">
<li><p>In this toy example, we assumed that we had item features. Often we also have access to user features such as their demographic information.</p></li>
<li><p>When such information is available, we can create item profiles similar to user profiles and train a regression model per item.</p></li>
<li><p>We can then predict ratings for each item using these models.</p></li>
<li><p>Often a weighted average of ratings given by item features and user features is used as the final rating.</p></li>
</ul>
<p><br><br></p>
</section>
<section id="miscellaneous-comments-on-content-based-filtering">
<h3>2.5 Miscellaneous comments on content-based filtering<a class="headerlink" href="#miscellaneous-comments-on-content-based-filtering" title="Permalink to this heading">#</a></h3>
<p><strong>Collaborative filtering vs. content-based filtering</strong></p>
<ul class="simple">
<li><p>Latent-factor approach to collaborative filtering, where we reconstruct rating for user <span class="math notranslate nohighlight">\(i\)</span> and item <span class="math notranslate nohighlight">\(j\)</span> as:
$<span class="math notranslate nohighlight">\(\hat{y}_{ij} = w_j^T z_{i}\)</span>$</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(w_j^T\)</span> are “hidden” features or embedding of item <span class="math notranslate nohighlight">\(j\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(z_i\)</span> are “hidden” features or embedding of user <span class="math notranslate nohighlight">\(i\)</span></p></li>
</ul>
</li>
<li><p>A linear model approach to content-based filtering, where we reconstruct rating for user <span class="math notranslate nohighlight">\(i\)</span> and item <span class="math notranslate nohighlight">\(j\)</span> as:<br />
$<span class="math notranslate nohighlight">\(\hat{y}_{ij} = w_i^T x_{ij}\)</span>$</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(x_{ij}\)</span> is a feature vector for user <span class="math notranslate nohighlight">\(i\)</span> and item <span class="math notranslate nohighlight">\(j\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(w\)</span> are the weights learned for user <span class="math notranslate nohighlight">\(i\)</span></p></li>
<li><p>Our usual supervised learning setup for linear regression.</p></li>
</ul>
</li>
</ul>
<p><strong>Fine-tuning your regression models</strong></p>
<ul class="simple">
<li><p>The feature matrix for movies can contain different types of features.</p>
<ul>
<li><p>Example: Plot of the movie (text features), actors (categorical features), year of the movie, budget and revenue of the movie (numerical features).</p></li>
<li><p>You’ll apply our usual preprocessing techniques to these features.</p></li>
</ul>
</li>
<li><p>If you have enough data, you could also carry out hyperparameter tuning with cross-validation for each model.</p></li>
<li><p>Finally, although we have been talking about linear models above, you can use any regression model of your choice.</p></li>
</ul>
<p><strong>Advantages of content-based filtering</strong></p>
<ul class="simple">
<li><p>We don’t need many users to provide ratings for an item.</p></li>
<li><p>Each user is modeled separately, so you might be able to capture uniqueness of taste.</p></li>
<li><p>Since you can obtain the features of the items, you can immediately recommend new items.</p>
<ul>
<li><p>This would not have been possible with collaborative filtering.</p></li>
</ul>
</li>
<li><p>Recommendations are more interpretable (if you use linear models)</p>
<ul>
<li><p>You can explain to the user why you are recommending an item because you have learned weights.</p></li>
</ul>
</li>
</ul>
<p><strong>Disadvantages of content-based filtering</strong></p>
<ul class="simple">
<li><p>Feature acquisition and feature engineering</p>
<ul>
<li><p>What features should we use to explain the difference in ratings?</p></li>
<li><p>Obtaining those features for each item might be very expensive.</p></li>
</ul>
</li>
<li><p>Less diversity: hardly recommend an item outside the user’s profile.</p></li>
</ul>
<p><br><br></p>
</section>
<section id="optional-hybrid-approaches">
<h3>2.6 (Optional) Hybrid approaches<a class="headerlink" href="#optional-hybrid-approaches" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Both collaborative filtering and content-based filtering have their own advantages and  suffer from their shortcomings.</p></li>
<li><p>Collaborative filtering exploits social information but it does not predict well for new movies/users.</p>
<ul>
<li><p>New movies don’t yet have ratings, and new users haven’t rated anything.</p></li>
</ul>
</li>
<li><p>Content-based approaches do not have this problem but they are less diverse and do not exploit information about similarity between users.</p></li>
<li><p>Can we combine the best of the two worlds?</p></li>
<li><p>There are several ways to combine collaborative filtering and content-based filtering:</p>
<ul>
<li><p>Build separate models for collaborative filtering and content-based filtering and combine their results. For example, the predicted rating can be a weighted average of ratings predicted by each model.</p></li>
<li><p>Include content-based item features in the collaborative filtering loss function. (Check out <a class="reference external" href="https://www.jmlr.org/papers/v13/chen12a.html">SVDfeature</a> (won “KDD Cup” in 2011 and 2012).)</p></li>
</ul>
</li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="questions-for-you">
<h2>❓❓ Questions for you<a class="headerlink" href="#questions-for-you" title="Permalink to this heading">#</a></h2>
<p><strong>iClicker cloud join link: https://join.iclicker.com/NGJD</strong></p>
<section id="exercise-8-1-select-all-of-the-following-statements-which-are-true-iclicker">
<h3>Exercise 8.1 Select all of the following statements which are <strong>True</strong> (iClicker)<a class="headerlink" href="#exercise-8-1-select-all-of-the-following-statements-which-are-true-iclicker" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>(A) In content-based filtering we leverage available item features in addition to similarity between users.</p></li>
<li><p>(B) In content-based filtering you represent each user in terms of <strong>known</strong> features of items whereas in collaborative filtering each user is represented with <strong>latent</strong> features of items.</p></li>
<li><p>(C) In the set up of content-based filtering we discussed, if you have a new movie, you would have problems predicting ratings for that movie.</p></li>
<li><p>(D) Interpretation of recommendations might be easier with content-based filtering compared to collaborative filtering.</p></li>
<li><p>(E) In content-based filtering if a user has a number of ratings in the training utility matrix but does not have any ratings in the validation utility matrix then we won’t be able to calculate RMSE for the validation utility matrix.</p></li>
</ul>
<p><br><br><br><br></p>
<div class="tip dropdown admonition">
<p class="admonition-title">V’s Solutions!</p>
<ul class="simple">
<li><p>B, D</p></li>
</ul>
</div>
<p><br><br><br><br></p>
</section>
</section>
<section id="miscellaneous-topics">
<h2>3. Miscellaneous topics<a class="headerlink" href="#miscellaneous-topics" title="Permalink to this heading">#</a></h2>
<hr><section id="types-of-data">
<h3>3.1 Types of data<a class="headerlink" href="#types-of-data" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Explicit data: ratings, thumbs up, etc.</p></li>
<li><p>Implicit data: collected from the users’ behaviour (e.g., mouse clicks, purchases, time spent doing something)</p></li>
<li><p>Trust implicit data that costs something, like time or even money.</p>
<ul>
<li><p>this makes it harder to fraud</p></li>
</ul>
</li>
</ul>
<p><br><br></p>
</section>
<section id="sparse-utility-matrix">
<h3>3.2 Sparse utility matrix<a class="headerlink" href="#sparse-utility-matrix" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Recommender systems work best when there is a large amount of data.</p></li>
<li><p>So far we’ve been working with small datasets.</p></li>
</ul>
<p>Let’s use the <a class="reference external" href="http://jmcauley.ucsd.edu/data/amazon/">Amazon product data set</a>. The authors of the data set have asked for the following citations:</p>
<blockquote>
<div><p>Ups and downs: Modeling the visual evolution of fashion trends with one-class collaborative filtering.
R. He, J. McAuley.
WWW, 2016.</p>
<p>Image-based recommendations on styles and substitutes.
J. McAuley, C. Targett, J. Shi, A. van den Hengel.
SIGIR, 2015.</p>
</div></blockquote>
<p>We will focus on the Patio, Lawn, and Garden section. You can download the <a class="reference external" href="http://snap.stanford.edu/data/amazon/productGraph/categoryFiles/ratings_Patio_Lawn_and_Garden.csv">ratings here</a>.</p>
<p>Let’s load the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;ratings_Patio_Lawn_and_Garden.csv&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">))</span>
<span class="n">ratings</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user</th>
      <th>item</th>
      <th>rating</th>
      <th>timestamp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A2VNYWOPJ13AFP</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1259798400</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A20DWVV8HML3AW</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1371081600</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A3RVP3YBYYOPRH</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1257984000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A28XY55TP3Q90O</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1314144000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A3VZW1BGUQO0V3</td>
      <td>0981850006</td>
      <td>5.0</td>
      <td>1308268800</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 993490 entries, 0 to 993489
Data columns (total 4 columns):
 #   Column     Non-Null Count   Dtype  
---  ------     --------------   -----  
 0   user       993490 non-null  object 
 1   item       993490 non-null  object 
 2   rating     993490 non-null  float64
 3   timestamp  993490 non-null  int64  
dtypes: float64(1), int64(1), object(2)
memory usage: 30.3+ MB
</pre></div>
</div>
</div>
</div>
<p>We’d like to construct the utility matrix <code class="docutils literal notranslate"><span class="pre">Y</span></code>. However, let’s see how big it would be:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_stats</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">item_key</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">,</span> <span class="n">user_key</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of ratings:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The average rating:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">]))</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]))</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of users:&quot;</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of items:&quot;</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fraction nonzero:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of full Y matrix (GB):&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">M</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="mf">1e9</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span>


<span class="n">N</span><span class="p">,</span> <span class="n">M</span> <span class="o">=</span> <span class="n">get_stats</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of ratings: 993490
The average rating: 4.006400668350965
Number of users: 714791
Number of items: 105984
Fraction nonzero: 1.3114269915944552e-05
Size of full Y matrix (GB): 606.051274752
</pre></div>
</div>
</div>
</div>
<p>606 GB! That is way too big. We don’t want to create that matrix! On the other hand, we see that we only have about 1 million ratings, which would be 8 MB or so (<span class="math notranslate nohighlight">\(10^6\)</span> numbers <span class="math notranslate nohighlight">\(\times\)</span> 8 bytes per number). Much more manageable!</p>
<p>Let’s create a sparse representation of our utility matrix <span class="math notranslate nohighlight">\(Y\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span> <span class="k">as</span> <span class="n">sparse_matrix</span>

<span class="n">user_key</span> <span class="o">=</span> <span class="s2">&quot;user&quot;</span>
<span class="n">item_key</span> <span class="o">=</span> <span class="s2">&quot;item&quot;</span>
<span class="n">user_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">))))</span>
<span class="n">item_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]),</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">))))</span>

<span class="n">user_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">])))</span>
<span class="n">item_inverse_mapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">])))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_Y</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">user_key</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="n">item_key</span><span class="o">=</span><span class="s2">&quot;item&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a sparse matrix using scipy.csr_matrix and mappers to relate indexes to items&#39; id.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    ratings: pd.DataFrame</span>
<span class="sd">        the ratings to be stored in the matrix;</span>
<span class="sd">    N: int</span>
<span class="sd">        the number of users</span>
<span class="sd">    M: int</span>
<span class="sd">        the number of items</span>
<span class="sd">    user_key: string</span>
<span class="sd">        the column in ratings that contains the users id</span>
<span class="sd">    item_key: string</span>
<span class="sd">        the column in ratings that contains the items id</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    Y: np.sparse</span>
<span class="sd">        the sparse matrix containing the ratings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_mapper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">[</span><span class="n">user_key</span><span class="p">]]</span>
    <span class="n">item_ind</span> <span class="o">=</span> <span class="p">[</span><span class="n">item_mapper</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ratings</span><span class="p">[</span><span class="n">item_key</span><span class="p">]]</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">sparse_matrix</span><span class="p">((</span><span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;rating&quot;</span><span class="p">],</span> <span class="p">(</span><span class="n">user_ind</span><span class="p">,</span> <span class="n">item_ind</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Y</span> <span class="o">=</span> <span class="n">create_Y</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
<span class="n">Y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;714791x105984 sparse matrix of type &#39;&lt;class &#39;numpy.float64&#39;&gt;&#39;
	with 993490 stored elements in Compressed Sparse Row format&gt;
</pre></div>
</div>
</div>
</div>
<p>Note the shape of <code class="docutils literal notranslate"><span class="pre">Y</span></code>: our rows are the users, and the columns are products.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sanity check</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># should be number of items by number of users</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">nnz</span><span class="p">)</span>  <span class="c1"># number of nonzero elements -- should equal number of ratings</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using sparse matrix data structure, the size of X is: </span><span class="si">{</span><span class="n">Y</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">nbytes</span><span class="o">/</span><span class="mf">1e6</span><span class="si">}</span><span class="s2">mb&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(714791, 105984)
993490
Using sparse matrix data structure, the size of X is: 7.94792mb
</pre></div>
</div>
</div>
</div>
<p>Let’s try <code class="docutils literal notranslate"><span class="pre">surprise</span></code> package on this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span> <span class="o">=</span> <span class="n">ratings</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">surprise</span>
<span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">SVD</span><span class="p">,</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">Reader</span>
<span class="kn">from</span> <span class="nn">surprise.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>

<span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">ratings</span><span class="p">,</span> <span class="n">reader</span><span class="p">)</span>  <span class="c1"># Load the data</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">algo</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">(</span><span class="n">n_factors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">,</span> <span class="s2">&quot;MAE&quot;</span><span class="p">],</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating RMSE, MAE of algorithm SVD on 5 split(s).

                  Fold 1  Fold 2  Fold 3  Fold 4  Fold 5  Mean    Std     
RMSE (testset)    1.2882  1.2891  1.2916  1.2912  1.2945  1.2909  0.0022  
MAE (testset)     1.0183  1.0186  1.0204  1.0200  1.0230  1.0200  0.0017  
Fit time          4.32    4.61    4.74    4.53    4.50    4.54    0.14    
Test time         0.81    0.56    0.89    0.84    0.83    0.79    0.11    
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>test_rmse</th>
      <th>test_mae</th>
      <th>fit_time</th>
      <th>test_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.288163</td>
      <td>1.018274</td>
      <td>4.317557</td>
      <td>0.812768</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.289117</td>
      <td>1.018571</td>
      <td>4.605982</td>
      <td>0.561459</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.291561</td>
      <td>1.020410</td>
      <td>4.735909</td>
      <td>0.886149</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.291203</td>
      <td>1.020018</td>
      <td>4.530619</td>
      <td>0.840300</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.294515</td>
      <td>1.022971</td>
      <td>4.504056</td>
      <td>0.830336</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s get some predictions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">user_id</span> <span class="o">=</span> <span class="s1">&#39;A2VNYWOPJ13AFP&#39;</span>
<span class="n">item_id</span> <span class="o">=</span> <span class="s1">&#39;B00IJB5MCS&#39;</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
<span class="n">pred</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prediction(uid=&#39;A2VNYWOPJ13AFP&#39;, iid=&#39;B00IJB5MCS&#39;, r_ui=None, est=4.771523282269237, details={&#39;was_impossible&#39;: False})
</pre></div>
</div>
</div>
</div>
<p>It’s hard to interpret the recommendations simply based on the item ids. How can we examine goodness of these recommendations? We can just append the id to amazon.com and view the product.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#from IPython.core.display import HTML, display</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="n">url_amazon</span> <span class="o">=</span> <span class="s2">&quot;https://www.amazon.com/dp/</span><span class="si">%s</span><span class="s2">&quot;</span>

<span class="k">def</span> <span class="nf">disp_url</span><span class="p">(</span><span class="n">item_id</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">url_amazon</span> <span class="o">%</span> <span class="n">item_id</span>
    <span class="n">display</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grill_spatula</span> <span class="o">=</span> <span class="s2">&quot;B00IJB5MCS&quot;</span>
<span class="n">grill_spatula_ind</span> <span class="o">=</span> <span class="n">item_mapper</span><span class="p">[</span><span class="n">grill_spatula</span><span class="p">]</span>
<span class="n">grill_spatula_vec</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">grill_spatula_ind</span><span class="p">]</span>
<span class="n">disp_url</span><span class="p">(</span><span class="n">grill_spatula</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;https://www.amazon.com/dp/B00IJB5MCS&#39;
</pre></div>
</div>
</div>
</div>
<p>This is the product.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.amazon.com/dp/B00IJB5MCS">Mr Grill - 18” Luxury Oak Barbecue Spatula / Turner</a>.</p></li>
</ul>
<p><strong>(Optional) Practice exercises for you</strong></p>
<p>Use scikit-learn’s <a class="reference external" href="http://scikit-learn.org/stable/modules/generated/sklearn.neighbors.NearestNeighbors.html">NearestNeighbors</a> object (which uses Euclidean distance by default) to find the 10 most similar items to <a class="reference external" href="https://www.amazon.com/dp/B00IJB5MCS">Mr Grill - 18” Luxury Oak Barbecue Spatula / Turner</a> using Euclidean distance and cosine distance. Which distance metric is giving you better recommendations?</p>
<blockquote>
<div><p>Try it out on your own or with your friends. I might not get a chance to post solutions for these questions.</p>
</div></blockquote>
<p><br><br><br><br></p>
</section>
</section>
<section id="beyond-error-rate-in-recommendation-systems">
<h2>4. Beyond error rate in recommendation systems<a class="headerlink" href="#beyond-error-rate-in-recommendation-systems" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>If a system gives the best RMSE it doesn’t necessarily mean that it’s going to give best recommendations.</p></li>
<li><p>In recommendation systems we do not have ground truth in the sense that there is no notion of “perfect” recommendations.</p></li>
<li><p>Training your model and evaluating it offline is not ideal.</p></li>
<li><p>Other aspects such as simplicity, interpretation, code maintainability are equally (if not more) important than best validation error.</p></li>
<li><p>Winning system of Netflix Challenge was never adopted.</p>
<ul>
<li><p>Big mess of ensembles was not really maintainable</p></li>
</ul>
</li>
<li><p>There are other considerations.</p></li>
</ul>
<p><strong>Diversity</strong></p>
<p>Are these good recommendations?</p>
<p>You are looking at <a class="reference external" href="https://www.amazon.ca/Sillbird-Education-Building-Science-Experiment/dp/B07XRN6TJ8">Education Solar Robot Toy</a>, are these good recommendations?</p>
<p><img alt="" src="../_images/reco-diversity.png" /></p>
<p>Now suppose you’ve recently bought Education Solar Robot Toy and rated them highly. Are these good recommendations now?</p>
<ul class="simple">
<li><p>Not really. Even though you really liked the item you don’t need similar items anymore.</p></li>
<li><p><strong>Diversity</strong> is about how different are the recommendations.</p>
<ul>
<li><p>Another example: Even if you really really like Star Wars, you might want non-Star-Wars suggestions.</p></li>
</ul>
</li>
<li><p>But be careful. We need a balance here.</p></li>
</ul>
<p><strong>Freshness</strong></p>
<p>Are these good recommendations?</p>
<p><img alt="" src="../_images/freshness.png" /></p>
<ul class="simple">
<li><p>Some of these books don’t have many ratings but it might be a good idea to recommend “fresh” things.</p></li>
<li><p><strong>Freshness</strong>: people tend to get more excited about new/surprising things.</p></li>
</ul>
<p><strong>Trust</strong></p>
<ul class="simple">
<li><p>But again you need a balance here. What would happen if you keep surprising users all the time?</p></li>
<li><p>There might be <strong>trust</strong> issues.</p></li>
<li><p>Another aspect of trust is explaining your recommendation, i.e., telling the user why you made a recommendation. This gives the user an opportunity to understand why your recommendations could be interesting to them.</p></li>
<li><p><a class="reference external" href="https://www.linkedin.com/pulse/injecting-gpt-4s-reasoning-recommendation-algorithms-peter-gostev/">Injecting GPT-4’s reasoning into recommendation systems</a></p></li>
</ul>
<p><strong>Persistence</strong>:</p>
<ul class="simple">
<li><p>How long should recommendations last?</p></li>
<li><p>If the user does not click on a recommendation for a while, should it remain a recommendation?</p></li>
</ul>
<p><strong>Social recommendation</strong>:</p>
<ul class="simple">
<li><p>What did your friends watch?</p></li>
<li><p>Many recommenders	are	now	connected to social	networks.</p></li>
<li><p>“Login using you Facebook	account”.</p></li>
<li><p>Often, people	like similar movies	to their friends.</p></li>
<li><p>If we get a new user, then recommendations are based on friend’s preferences.</p></li>
</ul>
<p><br><br><br><br></p>
<section id="final-comments-and-summary">
<h3>Final comments and summary<a class="headerlink" href="#final-comments-and-summary" title="Permalink to this heading">#</a></h3>
</section>
<section id="what-did-we-cover">
<h3>What did we cover?<a class="headerlink" href="#what-did-we-cover" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>There is a big world of recommendation systems out there. We talked about some basic traditional approaches to recommender systems.</p>
<ul>
<li><p>collaborative filtering</p></li>
<li><p>content-based filtering</p></li>
</ul>
</li>
</ul>
<p>If you want to know more advanced approaches to recommender systems, watch this 4-hour summer school tutorial by Xavier Amatriain, Research/Engineering Director &#64; Netflix.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=bLhq63ygoU8">Part1</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=mRToFXlNBpQ">Part2</a></p></li>
</ul>
</section>
<section id="reminder">
<h3>Reminder<a class="headerlink" href="#reminder" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Recommendation systems can have terrible consequences, especially in the context of politics and extremism.</p></li>
<li><p>They can cause the phenomenon called “filter bubbles”.</p></li>
<li><p>Ask hard and uncomfortable questions to yourself (and to your employer if possible) before implementing and deploying a recommendation system.</p></li>
</ul>
<p><br><br><br><br></p>
</section>
</section>
<section id="questions-for-you-time-permitting">
<h2>❓❓ Questions for you (time-permitting)<a class="headerlink" href="#questions-for-you-time-permitting" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Discuss memory-related problems that may cause when dealing with large number of users and items.</p></li>
<li><p>We have been ignoring the timestamp column in ratings datasets. How you might use this information when making recommendations?</p></li>
</ul>
<p><br><br><br><br></p>
</section>
<section id="course-roadmap">
<h2>Course roadmap<a class="headerlink" href="#course-roadmap" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Week 1 ✅</p>
<ul>
<li><p>Clustering</p></li>
</ul>
</li>
<li><p>Week 2 ✅</p>
<ul>
<li><p>Dimensionality reduction</p></li>
</ul>
</li>
<li><p>Week 3 ✅</p>
<ul>
<li><p>Word embeddings, t-SNE</p></li>
</ul>
</li>
<li><p>Week 4 ✅</p>
<ul>
<li><p>Recommendation systems</p></li>
</ul>
</li>
</ul>
<p><img alt="" src="../_images/eva-accomplished.png" /></p>
<section id="time-for-course-evaluations">
<h3>Time for course evaluations<a class="headerlink" href="#time-for-course-evaluations" title="Permalink to this heading">#</a></h3>
<p>That’s all for this course! It was fun teaching you this material. Thanks for your support, feedback, and great questions ❤️!</p>
<p>I would love to hear your thought on this course. When you get a chance, it’ll be great if you fill in the evaluation survey for this course on <a class="reference external" href="https://canvas.ubc.ca/courses/106525/external_tools/4732">Canvas</a>.</p>
<p>The evaluation closing date is: <strong>March 24, 2023</strong></p>
</section>
</section>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>If you want to know more advanced approaches to recommender systems, watch this 4-hour summer school tutorial by Xavier Amatriain, Research/Engineering Director &#64; Netflix. (<a class="reference external" href="https://www.youtube.com/watch?v=bLhq63ygoU8">Part1</a>, <a class="reference external" href="https://www.youtube.com/watch?v=mRToFXlNBpQ">Part2</a>)</p></li>
<li><p><a class="reference external" href="https://sudonull.com/post/65548-10-lessons-of-the-Quora-recommendation-system-Retail-Rocket-Blog">10 lessons of the Quora recommendation system</a></p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "conda-env-563-py"
        },
        kernelOptions: {
            name: "conda-env-563-py",
            path: "./lectures"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'conda-env-563-py'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="07_recommender-systems1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 7: Recommender Systems Part I</p>
      </div>
    </a>
    <a class="right-next"
       href="AppendixA.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Appendix A: K-Means customer segmentation case study</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-plan-imports-and-los">Lecture plan, imports, and LOs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#lecture-plan">Lecture plan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-outcomes">Learning outcomes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recap">1. Recap</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-recommender-systems-problem">1.1 Recap: Recommender systems problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-main-approaches">1.2 Recap: Main approaches</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recap-collaborative-filtering">1.3 Recap: Collaborative filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#measuring-similarity-distances">1.4 Measuring similarity/distances</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#content-based-filtering">2. Content-based filtering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#movie-features">2.1 Movie features</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#building-user-profiles">2.2 Building user profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supervised-approach-to-rating-prediction">2.3 Supervised approach to rating prediction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#completing-the-utility-matrix-with-content-based-filtering">2.4 Completing the utility matrix with content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellaneous-comments-on-content-based-filtering">2.5 Miscellaneous comments on content-based filtering</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optional-hybrid-approaches">2.6 (Optional) Hybrid approaches</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you">❓❓ Questions for you</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-8-1-select-all-of-the-following-statements-which-are-true-iclicker">Exercise 8.1 Select all of the following statements which are <strong>True</strong> (iClicker)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#miscellaneous-topics">3. Miscellaneous topics</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#types-of-data">3.1 Types of data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sparse-utility-matrix">3.2 Sparse utility matrix</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beyond-error-rate-in-recommendation-systems">4. Beyond error rate in recommendation systems</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#final-comments-and-summary">Final comments and summary</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-did-we-cover">What did we cover?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reminder">Reminder</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#questions-for-you-time-permitting">❓❓ Questions for you (time-permitting)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#course-roadmap">Course roadmap</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-for-course-evaluations">Time for course evaluations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resources">Resources</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Varada Kolhatkar
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>